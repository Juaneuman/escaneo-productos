// Base de datos de productos simulada
const productsDB = {
    "123456789": { name: "Audífonos Lenovo", price: 15000 },
    "987654321": { name: "Soporte Bicicleta", price: 12000 },
    "555555555": { name: "Batería Portátil", price: 14000 },
    "111111111": { name: "Cargador iPhone", price: 13000 },
    "222222222": { name: "Cable USB-C", price: 8000 },
    "333333333": { name: "Funda Celular", price: 5000 },
    "444444444": { name: "Teclado Mecánico", price: 15000 },
    "555555556": { name: "Mouse Gamer", price: 14000 },
    "666666666": { name: "Power Bank Solar", price: 14500 },
    "777777777": { name: "Altavoz Bluetooth", price: 11000 }
};

// Cargar carrito desde Local Storage (si existe)
const savedCart = localStorage.getItem("cart");
const cart = savedCart ? JSON.parse(savedCart) : [];

// Variables
const cameraElement = document.getElementById('camera');
const outputElement = document.getElementById('output');
const cartElement = document.getElementById('cart');
const totalElement = document.getElementById('total');

// Inicializar lector de código de barras
const codeReader = new ZXing.BrowserBarcodeReader();

codeReader.decodeFromVideoDevice(undefined, cameraElement, (result, err) => {
    if (result) {
        const code = result.text;
        outputElement.textContent = `Código escaneado: ${code}`;

        // Buscar producto en la base de datos
        if (productsDB[code]) {
            addToCart(productsDB[code]);
        } else {
            alert("Producto no encontrado");
        }
    }
});

// Función para agregar productos al carrito
function addToCart(product) {
    const existingProduct = cart.find(item => item.name === product.name);

    if (existingProduct) {
        const confirmAdd = confirm(`El producto "${product.name}" ya está en el carrito. ¿Deseas agregarlo nuevamente?`);
        if (!confirmAdd) {
            return;
        }
    }

    cart.push(product);
    updateCart();
}

// Actualizar el carrito
function updateCart() {
    // Limpiar tabla
    cartElement.innerHTML = "";
    let total = 0;

    // Agregar filas
    cart.forEach((item, index) => {
        total += item.price;
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${item.name}</td>
            <td>$${item.price}</td>
            <td><button onclick="removeFromCart(${index})">Eliminar</button></td>
        `;
        cartElement.appendChild(row);
    });

    // Actualizar total
    totalElement.textContent = total;

    // Guardar carrito en Local Storage
    localStorage.setItem("cart", JSON.stringify(cart));
}

// Eliminar producto del carrito
function removeFromCart(index) {
    cart.splice(index, 1);
    updateCart();
}

// Cargar carrito al inicio
updateCart();
